// We calculate a verdict based on an eventString that is 1000 characters long
// We are interested in how fast we can calculate the state of the system

//Results on an Arduino Mega 2560
//Verdict: Satisfied,Violated,Inconclusive
//21:51:32.172 -> Start Verdict: 1.00,0.00,0.00
//21:51:32.836 -> End Verdict: 0.77,0.23,0.00

//Results with updated transition logic
//10:12:32.538 -> Start Verdict: 1.00,0.00,0.00
//10:12:33.177 -> End Verdict: 1.00,0.00,0.00

#include <List.hpp>
#include <State.hpp>
#include <ProbTransition.hpp>
#include <ProbStatemachine.hpp>
#include <automatons/properties/untimed/occurence/UniversalityProperty/UniversalityBetweenQAndRProperty.hpp>

UniversalityBetweenQAndRProperty automaton;
vector<uint8_t> events_to_process = {EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_P, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_P, EVENT_P, EVENT_P, EVENT_P, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_Q, EVENT_R, EVENT_NONE, EVENT_NONE, EVENT_NONE, EVENT_NONE};
int events_processed = 0;

void setup() {
  Serial.begin(9600);
  Serial.flush();
}

void loop() {
  if (Serial.available()) {
    if (events_processed < events_to_process.size()) {

      //log initial state
      if(events_processed == 0){
        std::map<Verdict, float> verdictProbabilities = automaton.getVerdictProbabilities();
        Serial.print("Start Verdict: ");
        Serial.print(verdictProbabilities[Verdict::SATISFIED]);
        Serial.print(",");
        Serial.print(verdictProbabilities[Verdict::VIOLATED]);
        Serial.print(",");
        Serial.println(verdictProbabilities[Verdict::INCONCLUSIVE]);
      }

      uint8_t event = events_to_process[events_processed];
      uint32_t timestamp = millis();

      Serial.print("Timestep: ");
      Serial.print(events_processed);
      Serial.print(", Event: ");
      Serial.print(event);
      automaton.changeStates(event, timestamp);
      events_processed += 1;

      //log state
      std::map<Verdict, float> verdictProbabilities = automaton.getVerdictProbabilities();
      Serial.print(", Verdict: ");
      Serial.print(verdictProbabilities[Verdict::SATISFIED]);
      Serial.print(", ");
      Serial.print(verdictProbabilities[Verdict::VIOLATED]);
      Serial.print(", ");
      Serial.println(verdictProbabilities[Verdict::INCONCLUSIVE]);
    }
  }
}

